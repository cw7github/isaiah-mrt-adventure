<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Math Integration Test</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; }
    .test-section { margin: 30px 0; padding: 20px; border: 2px solid #e9ecef; border-radius: 12px; }
    .test-section h2 { margin-top: 0; color: #2c3e50; }
    .test-result { padding: 10px; margin: 10px 0; border-radius: 8px; }
    .test-result.pass { background: #d4edda; color: #155724; }
    .test-result.fail { background: #f8d7da; color: #721c24; }
    .test-result.pending { background: #fff3cd; color: #856404; }
    #testContainer { background: #f8f9fa; padding: 20px; border-radius: 16px; margin: 20px 0; }
    button { padding: 12px 24px; font-size: 16px; border-radius: 8px; cursor: pointer; margin: 8px; }
    .btn-primary { background: #3498db; color: white; border: none; }
    .btn-success { background: #27ae60; color: white; border: none; }
  </style>
</head>
<body>
  <h1>üß™ Math Integration Test Suite</h1>

  <div class="test-section">
    <h2>1. Visual Components</h2>
    <div id="visualTests"></div>
    <button class="btn-primary" onclick="testVisuals()">Run Visual Tests</button>
  </div>

  <div class="test-section">
    <h2>2. Content Pack Loading</h2>
    <div id="contentTests"></div>
    <button class="btn-primary" onclick="testContentPack()">Test Content Pack</button>
  </div>

  <div class="test-section">
    <h2>3. Lesson Flow</h2>
    <div id="flowTests"></div>
    <button class="btn-primary" onclick="testLessonFlow()">Test Lesson Flow</button>
  </div>

  <div class="test-section">
    <h2>4. Live Preview</h2>
    <div id="testContainer"></div>
    <button class="btn-success" onclick="previewNumberLine()">Number Line</button>
    <button class="btn-success" onclick="previewCounters()">Counters</button>
    <button class="btn-success" onclick="previewTenFrame()">Ten Frame</button>
    <button class="btn-success" onclick="previewShapes()">2D Shapes</button>
    <button class="btn-success" onclick="preview3DShape()">3D Cube</button>
  </div>

  <script>
    // Test functions will be added here
    const testResults = { pass: 0, fail: 0 };

    function logResult(container, name, passed, message) {
      const div = document.createElement('div');
      div.className = `test-result ${passed ? 'pass' : 'fail'}`;
      div.innerHTML = `${passed ? '‚úÖ' : '‚ùå'} <strong>${name}</strong>: ${message}`;
      document.getElementById(container).appendChild(div);
      passed ? testResults.pass++ : testResults.fail++;
    }

    async function testVisuals() {
      document.getElementById('visualTests').innerHTML = '';

      // Test if renderMathVisual function exists
      logResult('visualTests', 'renderMathVisual',
        typeof window.renderMathVisual === 'function',
        typeof window.renderMathVisual === 'function' ? 'Function exists' : 'Function not found');

      // Test if renderNumberLine exists
      logResult('visualTests', 'renderNumberLine',
        typeof window.renderNumberLine === 'function',
        typeof window.renderNumberLine === 'function' ? 'Function exists' : 'Function not found');

      // Test if renderCounters exists
      logResult('visualTests', 'renderCounters',
        typeof window.renderCounters === 'function',
        typeof window.renderCounters === 'function' ? 'Function exists' : 'Function not found');

      // Test if CPASystem exists
      logResult('visualTests', 'CPASystem',
        typeof window.CPASystem === 'object',
        typeof window.CPASystem === 'object' ? 'Object exists' : 'Object not found');
    }

    async function testContentPack() {
      document.getElementById('contentTests').innerHTML = '';

      try {
        const response = await fetch('/content/cpa-grade1-math/content-pack.v1.json');
        logResult('contentTests', 'Content Pack Fetch', response.ok,
          response.ok ? `Status: ${response.status}` : `Failed: ${response.status}`);

        if (response.ok) {
          const data = await response.json();

          logResult('contentTests', 'Schema Version', data.schemaVersion === 1,
            `Schema version: ${data.schemaVersion}`);

          logResult('contentTests', 'Station Count', Object.keys(data.stations).length >= 28,
            `${Object.keys(data.stations).length} stations found`);

          logResult('contentTests', 'Station Order', data.stationOrder.length >= 28,
            `${data.stationOrder.length} stations in order`);

          // Check for math-specific fields
          const firstStation = data.stations[data.stationOrder[0]];
          logResult('contentTests', 'Math Fields',
            firstStation && firstStation.mathFocus,
            firstStation?.mathFocus ? 'mathFocus found' : 'mathFocus missing');
        }
      } catch (error) {
        logResult('contentTests', 'Content Pack Load', false, error.message);
      }
    }

    async function testLessonFlow() {
      document.getElementById('flowTests').innerHTML = '';

      // Check subject switching
      logResult('flowTests', 'Subject Switching',
        typeof window.switchSubject === 'function',
        typeof window.switchSubject === 'function' ? 'Function exists' : 'Function not found');

      // Check station selection state
      logResult('flowTests', 'Station Selection State',
        typeof window.stationSelection === 'object',
        typeof window.stationSelection === 'object' ? 'State object exists' : 'State not found');

      // Check MATH_LINE_CONFIG
      logResult('flowTests', 'Math Line Config',
        typeof window.MATH_LINE_CONFIG === 'object',
        typeof window.MATH_LINE_CONFIG === 'object' ? 'Config exists' : 'Config not found');
    }

    function previewNumberLine() {
      const container = document.getElementById('testContainer');
      container.innerHTML = '<h3>Number Line Preview</h3>';
      if (window.renderMathVisual) {
        window.renderMathVisual({
          type: 'numberLine',
          data: { start: 0, end: 15, highlight: [5, 6, 7, 8] }
        }, container);
      } else {
        container.innerHTML += '<p style="color:red">renderMathVisual not found</p>';
      }
    }

    function previewCounters() {
      const container = document.getElementById('testContainer');
      container.innerHTML = '<h3>Counters Preview</h3>';
      if (window.renderMathVisual) {
        window.renderMathVisual({
          type: 'counters',
          data: { count: 8, groupOf: 5, style: 'apples' }
        }, container);
      }
    }

    function previewTenFrame() {
      const container = document.getElementById('testContainer');
      container.innerHTML = '<h3>Ten Frame Preview</h3>';
      if (window.renderMathVisual) {
        window.renderMathVisual({
          type: 'tenFrame',
          data: { count: 7, style: 'dots' }
        }, container);
      }
    }

    function previewShapes() {
      const container = document.getElementById('testContainer');
      container.innerHTML = '<h3>2D Shapes Preview</h3>';
      if (window.renderMathVisual) {
        window.renderMathVisual({
          type: 'shapes',
          data: { shapes: ['circle', 'square', 'triangle', 'rectangle'], highlight: 'triangle' }
        }, container);
      }
    }

    function preview3DShape() {
      const container = document.getElementById('testContainer');
      container.innerHTML = '<h3>3D Shape Preview</h3>';
      if (window.renderMathVisual) {
        window.renderMathVisual({
          type: '3dShape',
          data: { shape: 'cube', showFaces: true }
        }, container);
      }
    }
  </script>

  <!-- Load the main app to get access to functions -->
  <script>
    // Load styles from main app
    const link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = '/index.html'; // This won't work, we need inline styles
  </script>
</body>
</html>
