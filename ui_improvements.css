/* ============================================================================
   COMPREHENSIVE UI IMPROVEMENTS FOR AUTISM-FRIENDLY EDUCATIONAL APP
   Created: 2025-12-21

   This file contains targeted CSS improvements to create a more cohesive,
   accessible, and child-friendly (especially autism-friendly) design system.

   KEY IMPROVEMENTS:
   1. Reduced visual complexity (fewer decorative elements)
   2. Improved color contrast (WCAG AAA compliance)
   3. Consistent spacing using defined variables
   4. Larger, more readable typography
   5. Guaranteed minimum touch targets (44px+)
   6. Simplified, purposeful animations
   7. Unified component styles
   8. Better visual hierarchy
   ============================================================================ */

/* ===== ENHANCED CSS VARIABLES ===== */
:root {
  /* === IMPROVED TEXT COLORS (Better Contrast) === */
  /* Old: --text-secondary: #6B6B6B (fails WCAG AAA on light backgrounds) */
  --text-primary: #2B2B2B; /* Darkened from #3B3B3B for better contrast */
  --text-secondary: #4A4A4A; /* Darkened from #6B6B6B for WCAG AAA compliance */
  --text-tertiary: #757575; /* Darkened from #9B9B9B for better readability */

  /* === IMPROVED TYPOGRAPHY SCALE === */
  /* Larger base sizes for young readers */
  --text-xs: 0.875rem;    /* Was: 0.75rem - too small for children */
  --text-sm: 1rem;        /* Was: 0.875rem */
  --text-base: 1.125rem;  /* Was: 1rem */
  --text-lg: 1.25rem;     /* Was: 1.125rem */
  --text-xl: 1.5rem;      /* Was: 1.25rem */
  --text-2xl: 1.75rem;    /* Was: 1.5rem */
  --text-3xl: 2.25rem;    /* Was: 2rem */
  --text-4xl: 2.75rem;    /* Was: 2.5rem */

  /* === CONSISTENT SPACING === */
  /* All spacing now uses defined variables */
  --space-4xs: 0.125rem;  /* New: 2px */
  --space-3xs: 0.1875rem; /* New: 3px */

  /* === GUARANTEED TOUCH TARGETS === */
  --touch-min: clamp(56px, 10vh, 80px);    /* Was: 60px - increased minimum */
  --touch-lg: clamp(68px, 12vh, 100px);    /* Was: 80px - increased minimum */
  --touch-target: clamp(44px, 6vh, 56px);  /* Minimum 44px (WCAG guideline) */

  /* === REDUCED VISUAL NOISE === */
  --grain-opacity: 0.015; /* Was: 0.03 - reduced by half */

  /* === SIMPLIFIED ANIMATION TIMING === */
  /* Slightly slower for better comprehension */
  --anim-instant: 0.15s;  /* Was: 0.1s */
  --anim-fast: 0.25s;     /* Was: 0.2s */
  --anim-medium: 0.4s;    /* Was: 0.35s */
  --anim-slow: 0.6s;      /* Was: 0.5s */
}

/* ===== CALM MODE ENHANCEMENTS ===== */
body.calm-mode {
  --grain-opacity: 0.01; /* Further reduced in calm mode */
}

/* Remove ALL decorative floating shapes in calm mode */
body.calm-mode .welcome-screen::before,
body.calm-mode .welcome-screen::after,
body.calm-mode .app-container::before,
body.calm-mode .app-container::after {
  display: none !important;
}

/* ===== REDUCED VISUAL NOISE (AUTISM-FRIENDLY) ===== */

/* Simplify grain texture - make it even more subtle */
body::after {
  opacity: var(--grain-opacity);
  mix-blend-mode: soft-light; /* Softer blending */
}

/* Reduce intensity of decorative corner accents */
.app-container::before,
.app-container::after {
  opacity: 0.08; /* Was: 0.15 - more subtle */
}

/* Simplify welcome screen decorative shapes */
.welcome-screen::before {
  opacity: 0.35; /* Was: 0.6 - less distracting */
  width: 60px;   /* Was: 80px - smaller */
  height: 60px;
}

.welcome-screen::after {
  opacity: 0.25; /* Was: 0.5 - less distracting */
  width: 50px;   /* Was: 60px - smaller */
  height: 50px;
}

/* ===== IMPROVED TYPOGRAPHY CONSISTENCY ===== */

/* Base body text */
body {
  font-size: 19px; /* Was: 18px - slightly larger for better readability */
  line-height: 1.65; /* Was: 1.7 - slight adjustment */
}

/* Welcome Screen */
.welcome-title {
  font-weight: 700; /* Was: 600 - stronger for clarity */
  line-height: 1.3;
}

.welcome-subtitle {
  font-size: clamp(1.125rem, 2.5vh, 1.25rem); /* Increased minimum size */
  color: var(--text-secondary); /* Now has better contrast */
  line-height: 1.55; /* Was: 1.6 - slight adjustment for readability */
}

/* MRT Map Title */
.mrt-title {
  font-size: clamp(1.5rem, 4vh, 2rem); /* Was: var(--text-2xl) - more responsive */
  font-weight: 700; /* Consistent with other titles */
  line-height: 1.3;
}

/* Station Names */
.station-name {
  font-size: clamp(1.1rem, 2.5vh, 1.3rem); /* More responsive */
  font-weight: 700; /* Maintain weight */
  line-height: 1.35; /* Was: 1.3 - slightly more breathing room */
}

.station-desc {
  font-size: clamp(0.9rem, 2vh, 1rem); /* Was: 0.85rem - larger minimum */
  color: var(--text-secondary); /* Better contrast */
  line-height: 1.5; /* Was: 1.4 - more readable */
}

/* Reading Section Text */
.sentence-display {
  font-size: clamp(1.5rem, 3.5vh, 1.8rem); /* Was: 1.35rem min - larger for young readers */
  font-weight: 600;
  line-height: 1.8; /* Was: 1.7 - more breathing room */
  letter-spacing: 0.02em;
}

/* Question Text */
.question-text {
  font-size: clamp(1.4rem, 3.7vh, 1.85rem); /* Larger for clarity */
  font-weight: 700; /* Maintain weight */
  line-height: 1.45; /* Was: 1.4 - more breathing room */
}

/* Answer Button Text */
.answer-btn .answer-text {
  font-size: clamp(1.125rem, 2.5vh, 1.35rem); /* Was: var(--text-lg) - larger */
  font-weight: 700; /* Was: 600 - stronger */
  line-height: 1.3;
}

/* ===== GUARANTEED TOUCH TARGETS ===== */

/* Control Buttons - ensure minimum 44px */
.control-btn {
  min-width: var(--touch-target);
  min-height: var(--touch-target);
}

.control-btn.control-text-btn {
  min-width: calc(var(--touch-target) + 12px); /* Ensure wider text buttons meet minimum */
  min-height: var(--touch-target);
  padding: 0 var(--space-md);
}

/* Station Buttons - already good, but ensure consistency */
.station-btn {
  min-height: var(--touch-lg); /* Was: 80px - use variable */
  padding: var(--space-lg) var(--space-lg) var(--space-lg) 90px;
}

/* Answer Buttons - ensure minimum touch target */
.answer-btn {
  min-height: var(--touch-lg); /* Ensure minimum */
  padding: var(--space-lg) var(--space-md);
}

/* Big Buttons - maintain size */
.big-btn {
  min-height: var(--touch-min);
  padding: var(--space-md) var(--space-2xl);
}

/* ===== CONSISTENT SPACING ===== */

/* Header */
.header {
  padding: var(--space-md) var(--space-lg); /* Use variables instead of clamp */
}

.header-controls {
  gap: var(--space-sm); /* Consistent gap */
}

/* Progress Bar */
.progress-container {
  padding: var(--space-md) var(--space-lg); /* Use consistent variables */
  gap: var(--space-md);
}

/* Progress Label */
.progress-label {
  font-size: var(--text-sm); /* Use variable */
}

/* Restaurant Screen */
.restaurant-screen {
  padding: var(--space-xl);
  padding-bottom: calc(var(--space-xl) + env(safe-area-inset-bottom, 0px));
  gap: var(--space-md);
}

/* Reading Section */
.reading-section {
  padding: 0; /* Reset to allow internal padding control */
  margin-bottom: var(--space-md);
}

.sentence-display {
  padding: var(--space-xl) var(--space-lg);
  gap: 0.4em; /* Maintain em-based gap for text */
  min-height: clamp(100px, 15vh, 140px); /* Was: 80px - larger minimum */
}

/* Question Section */
.question-section {
  padding: var(--space-xl) var(--space-lg);
}

.question-text {
  margin-bottom: var(--space-lg); /* Was: var(--space-md) */
  padding: 0 var(--space-sm);
}

.answer-grid {
  gap: var(--space-lg); /* Was: var(--space-md) - more breathing room */
}

/* ===== IMPROVED COLOR CONTRAST ===== */

/* Ensure all text meets WCAG AAA standards */
.progress-label {
  color: var(--text-primary); /* Was: var(--text-secondary) - better contrast */
  font-weight: 600; /* Slightly bolder for clarity */
}

.station-desc {
  color: var(--text-secondary); /* Now has improved contrast */
}

.mrt-progress-info {
  color: var(--text-primary); /* Was: #37474F - use consistent variable */
}

.welcome-subtitle {
  color: var(--text-secondary); /* Better contrast */
}

/* Reading passage header - ensure text is readable */
.reading-section::before {
  font-weight: 700; /* Maintain weight */
  text-shadow: 0 1px 3px rgba(0,0,0,0.25); /* Stronger shadow for readability */
}

/* ===== SIMPLIFIED ANIMATIONS (AUTISM-FRIENDLY) ===== */

/* Reduce bounce intensity */
@keyframes gentle-bounce {
  0%, 100% { transform: translateY(0) scale(1); }
  50% { transform: translateY(-8px) scale(1.01); } /* Was: -12px and 1.02 - gentler */
}

/* Simplify float animation */
@keyframes float {
  0%, 100% { transform: translateY(0) rotate(0deg); }
  50% { transform: translateY(-12px) rotate(2deg); } /* Was: -20px and 5deg - gentler */
}

/* Reduce pulse intensity */
@keyframes gentlePulse {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.02); /* Was: 1.03 - more subtle */
  }
}

/* Simplify celebration animation */
@keyframes celebration-bounce {
  0%, 100% { transform: scale(1) rotate(0deg); }
  25% { transform: scale(1.05) rotate(-2deg); } /* Was: 1.08 and -4deg */
  75% { transform: scale(1.05) rotate(2deg); }  /* Was: 1.08 and 4deg */
}

/* Reduce sticker sparkle intensity */
.sticker-earned::before,
.sticker-earned::after {
  width: 8px;  /* Was: 12px - smaller */
  height: 8px; /* Was: 12px - smaller */
}

/* ===== UNIFIED BUTTON STYLES ===== */

/* Consistent border radius for all buttons */
.big-btn {
  border-radius: var(--radius-xl); /* Consistent */
}

.answer-btn {
  border-radius: var(--radius-lg); /* Was: 16px - use variable */
}

.station-btn {
  border-radius: var(--radius-xl); /* Was: 20px - use variable */
}

.control-btn {
  border-radius: var(--radius-md); /* Consistent */
}

/* Consistent transition timing */
.big-btn,
.answer-btn,
.station-btn,
.control-btn {
  transition: all var(--anim-fast) var(--ease-out-soft);
}

/* ===== IMPROVED VISUAL HIERARCHY ===== */

/* Stronger differentiation between sections */
.reading-section {
  box-shadow:
    0 6px 24px rgba(139, 90, 43, 0.14), /* Slightly stronger */
    0 2px 8px rgba(0,0,0,0.08),
    inset 0 1px 0 rgba(255,255,255,0.95);
  border: 3px solid rgba(210, 180, 140, 0.5); /* Was: 2px - more defined */
}

.question-section {
  box-shadow:
    0 6px 20px rgba(255, 152, 0, 0.12), /* Slightly stronger */
    inset 0 1px 0 rgba(255,255,255,0.9);
  border: 3px solid rgba(255, 183, 77, 0.4); /* Was: 2px - more defined */
}

/* Clearer header distinction */
.header {
  box-shadow: 0 4px 12px rgba(74, 144, 194, 0.2); /* Add shadow for depth */
}

/* Stronger progress bar definition */
.progress-bar {
  height: 12px; /* Was: 10px - slightly taller */
  box-shadow:
    var(--shadow-inner),
    0 1px 3px rgba(0,0,0,0.08); /* Additional outer shadow */
}

/* ===== IMPROVED FOCUS STATES (ACCESSIBILITY) ===== */

/* Clearer focus indication for keyboard navigation */
.big-btn:focus-visible,
.answer-btn:focus-visible,
.station-btn:focus-visible,
.control-btn:focus-visible {
  outline: 3px solid var(--mrt-blue);
  outline-offset: 3px;
}

/* Word focus in reading */
.word:focus-visible {
  outline: 2px solid var(--mrt-blue);
  outline-offset: 2px;
  border-radius: var(--radius-sm);
}

/* ===== MOBILE RESPONSIVENESS IMPROVEMENTS ===== */

/* Better landscape orientation handling */
@media screen and (max-height: 600px) and (orientation: landscape) {
  body {
    font-size: 17px; /* Slightly smaller for landscape */
  }

  .welcome-illustration,
  .welcome-mascot {
    margin-bottom: var(--space-sm);
  }

  .sentence-display {
    font-size: clamp(1.35rem, 3.2vh, 1.65rem);
    padding: var(--space-lg) var(--space-md);
    min-height: 80px; /* Reduced for landscape */
  }

  .question-text {
    font-size: clamp(1.25rem, 3.2vh, 1.6rem);
  }
}

/* Tablet optimizations */
@media screen and (min-width: 640px) and (max-width: 1024px) {
  body {
    font-size: 20px; /* Larger on tablets */
  }

  .sentence-display {
    font-size: clamp(1.6rem, 3.5vh, 1.9rem);
  }

  .question-text {
    font-size: clamp(1.5rem, 3.7vh, 1.95rem);
  }
}

/* ===== CONSISTENCY FIXES ===== */

/* Ensure all cards use consistent shadows */
.station-btn {
  box-shadow: var(--shadow-md); /* Use defined variable */
}

.station-btn:hover:not(:disabled) {
  box-shadow: var(--shadow-lg); /* Use defined variable */
}

/* Consistent answer button shadows */
.answer-btn {
  box-shadow: var(--shadow-md);
}

.answer-btn:hover:not(:disabled):not(.wrong) {
  box-shadow: var(--shadow-lg);
}

/* Consistent modal styling */
.modal-content {
  padding: var(--space-2xl); /* Was: var(--space-xl) */
  border-radius: var(--radius-2xl);
  box-shadow: var(--shadow-xl);
}

/* ===== IMPROVED WORD HIGHLIGHTING (READING) ===== */

/* Clearer highlight with better contrast */
.word.highlighted {
  background: var(--accent-golden);
  transform: scale(1.1); /* Was: 1.08 - slightly larger for clarity */
  box-shadow:
    0 4px 16px rgba(249, 213, 110, 0.4), /* Stronger shadow */
    0 0 0 3px rgba(249, 213, 110, 0.3); /* Add glow ring */
  font-weight: 700; /* Bolder when highlighted */
  z-index: 10; /* Ensure it appears above other words */
  position: relative;
}

/* Better hover state for words */
.word:hover {
  background: var(--mrt-blue-whisper);
  box-shadow: 0 0 0 3px var(--mrt-blue-pale); /* Was: 2px - more visible */
  transform: scale(1.02); /* Slight scale on hover */
}

/* ===== IMPROVED ANSWER BUTTON FEEDBACK ===== */

/* Clearer correct answer state */
.answer-btn.correct {
  border-width: 4px; /* Was: 3px - more prominent */
  border-color: var(--success-green);
  font-weight: 700; /* Bolder */
}

/* Clearer wrong answer state */
.answer-btn.wrong {
  opacity: 0.35; /* Was: 0.45 - more obviously disabled */
  filter: grayscale(50%); /* Was: 30% - more distinct */
}

/* ===== STATION BUTTON IMPROVEMENTS ===== */

/* Better visual feedback on hover */
.station-btn:hover:not(:disabled) {
  transform: translateX(6px); /* Was: 8px - slightly subtler */
  border-left-width: 4px; /* Consistent */
}

/* Clearer disabled state */
.station-btn:disabled {
  opacity: 0.45; /* Was: 0.5 - more obviously disabled */
  filter: grayscale(80%); /* Was: 70% - more distinct */
}

/* Better completed state */
.station-btn.completed {
  border-left-width: 5px; /* Was: 4px - more prominent */
  box-shadow:
    var(--shadow-md),
    0 0 0 2px rgba(124, 179, 66, 0.2); /* Add success glow */
}

/* ===== REWARD SCREEN IMPROVEMENTS ===== */

/* Better balanced reward screen */
.reward-screen {
  padding: var(--space-2xl) var(--space-xl);
}

.reward-celebration {
  font-size: clamp(3.5rem, 10vh, 5rem); /* Was: 4.5rem - more responsive */
}

.reward-title {
  font-size: clamp(2rem, 5vh, 2.75rem); /* More responsive */
  font-weight: 700; /* Consistent with other titles */
  line-height: 1.3;
}

.sticker-earned {
  font-size: clamp(3rem, 8vh, 4rem); /* More responsive */
  padding: var(--space-2xl); /* Was: var(--space-lg) - more generous */
}

/* ===== PRINT & HIGH CONTRAST MODE SUPPORT ===== */

@media print {
  /* Hide decorative elements when printing */
  body::before,
  body::after,
  .welcome-screen::before,
  .welcome-screen::after,
  .app-container::before,
  .app-container::after {
    display: none !important;
  }

  /* Ensure text is black for printing */
  body {
    color: #000;
  }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  :root {
    --text-primary: #000000;
    --text-secondary: #1A1A1A;
    --text-tertiary: #333333;
  }

  /* Ensure all interactive elements have clear borders */
  .big-btn,
  .answer-btn,
  .station-btn {
    border: 2px solid currentColor;
  }
}

/* ===== ADDITIONAL ACCESSIBILITY IMPROVEMENTS ===== */

/* Skip to content link for keyboard users */
.skip-to-content {
  position: absolute;
  top: -100px;
  left: 0;
  background: var(--mrt-blue);
  color: white;
  padding: var(--space-md);
  z-index: 10000;
  border-radius: var(--radius-md);
}

.skip-to-content:focus {
  top: var(--space-md);
}

/* Ensure reduced motion is respected */
@media (prefers-reduced-motion: reduce) {
  /* Remove all decorative animations */
  .welcome-screen::before,
  .welcome-screen::after,
  .sticker-earned::before,
  .sticker-earned::after {
    animation: none !important;
  }

  /* Keep only essential UI transitions */
  .progress-fill,
  .mrt-progress-fill,
  .mrt-progress-simple-fill {
    transition: width 0.3s ease !important;
  }
}

/* ===== Z-INDEX MANAGEMENT ===== */
/* Establish clear z-index layering to prevent stacking issues */

.grain-overlay { z-index: 9999; }
.modal-overlay { z-index: 1000; }
.header { z-index: 100; }
.word.highlighted { z-index: 10; }
.screen { z-index: 1; }

/* ===== SUMMARY OF KEY IMPROVEMENTS ===== */

/*
✅ TYPOGRAPHY
- Increased minimum text sizes for better readability by young children
- Improved contrast ratios (WCAG AAA compliance)
- Consistent font weights and line heights
- Responsive sizing with better clamp() ranges

✅ SPACING
- Consistent use of spacing variables throughout
- More generous padding in dense sections
- Better breathing room in reading areas
- Responsive spacing that scales properly

✅ TOUCH TARGETS
- All interactive elements meet 44px minimum (WCAG guideline)
- Generous padding for easier tapping
- Clear touch feedback
- Appropriate sizing for child users

✅ AUTISM-FRIENDLY DESIGN
- Reduced visual noise (grain, decorative elements)
- Simplified animations (gentler, less distracting)
- Clearer visual hierarchy
- Predictable, consistent patterns
- Option to fully disable decorations in calm mode

✅ VISUAL HIERARCHY
- Stronger shadows on key sections
- Better defined borders
- Clearer focus states
- Improved contrast between elements

✅ CONSISTENCY
- Unified button styles
- Consistent border radiuses
- Standardized transitions
- Cohesive color usage

✅ ACCESSIBILITY
- Better focus indicators
- High contrast mode support
- Reduced motion respect
- Print-friendly styles
- Clear disabled states

✅ MOBILE RESPONSIVENESS
- Better landscape handling
- Tablet optimizations
- Improved clamp() ranges
- Responsive touch targets
*/

/* ===== NEW UI ELEMENTS ===== */

/* Segmented Control for Font Size */
.segmented-control {
  display: flex;
  background: rgba(0,0,0,0.05); /* Very subtle background */
  padding: 4px; /* Was: 2px */
  border-radius: var(--radius-lg);
  gap: 4px; /* Was: 2px */
  width: 100%;
}

.segment-btn {
  flex: 1;
  border: none;
  background: transparent;
  padding: 8px; /* Was: 6px 12px */
  border-radius: var(--radius-md); /* Was: 10px */
  cursor: pointer;
  font-family: var(--font-display);
  font-weight: 600;
  color: var(--text-secondary); /* Was: #666 */
  transition: all 0.2s ease;
  font-size: 1rem;
}

.segment-btn:hover {
  background: rgba(255, 255, 255, 0.5); /* Was: 0.4 */
  color: var(--text-primary);
}

.segment-btn.active {
  background: #FFFFFF;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* Was: 0.08 */
  color: var(--mrt-blue); /* Active color */
  font-weight: 700;
}

/* Font Size Overrides */
body.text-lg {
  --text-xs: 1rem;
  --text-sm: 1.125rem;
  --text-base: 1.25rem;
  --text-lg: 1.5rem;
  --text-xl: 1.75rem;
  --text-2xl: 2rem;
  --text-3xl: 2.5rem;
  --text-4xl: 3rem;
}

body.text-xl {
  --text-xs: 1.125rem;
  --text-sm: 1.25rem;
  --text-base: 1.5rem;
  --text-lg: 1.75rem;
  --text-xl: 2rem;
  --text-2xl: 2.25rem;
  --text-3xl: 3rem;
  --text-4xl: 3.5rem;
}

/* High Contrast Mode */
body.high-contrast {
  --bg-cream: #FFFFFF;
  --bg-cream-warm: #FFFFFF;
  --bg-cream-cool: #F0F0F0;
  --text-primary: #000000;
  --text-secondary: #000000;
  --text-tertiary: #000000;
  --mrt-blue: #0056b3;
  --accent-golden: #ffd700;
  --accent-coral: #ff6b6b;
  --accent-mint: #20c997;
  
  /* Remove textures */
  --grain-opacity: 0;
}

body.high-contrast .big-btn,
body.high-contrast .answer-btn,
body.high-contrast .station-btn,
body.high-contrast .control-btn,
body.high-contrast .word {
  border: 2px solid #000000;
  box-shadow: none;
}
